<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedXAI - Explainable AI for Medical Imaging</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Slab:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: #f1f5f9;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), #1e40af);
            color: white;
            padding: 25px 0;
            box-shadow: var(--card-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 32px;
            color: var(--secondary);
        }
        
        .logo h1 {
            font-family: 'Roboto Slab', serif;
            font-size: 28px;
            font-weight: 600;
        }
        
        .logo span {
            color: var(--secondary);
        }
        
        .header-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .ai-model {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        @media (max-width: 1100px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }
        
        /* Panels */
        .panel {
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            padding: 25px;
            margin-bottom: 30px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .panel:hover {
            box-shadow: var(--card-shadow-hover);
        }
        
        .panel-title {
            font-family: 'Roboto Slab', serif;
            font-size: 22px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gray-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title i {
            color: var(--primary);
        }
        
        /* Image Upload Section */
        .upload-area {
            border: 3px dashed var(--gray-light);
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 25px;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background-color: rgba(37, 99, 235, 0.03);
        }
        
        .upload-area i {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .upload-area h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .upload-area p {
            color: var(--gray);
            font-size: 14px;
        }
        
        .sample-images {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .sample-img {
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .sample-img:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }
        
        .sample-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .sample-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 12px;
            padding: 4px;
            text-align: center;
        }
        
        /* Image Display */
        .image-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .image-container {
            width: 100%;
            height: 300px;
            border-radius: 10px;
            overflow: hidden;
            background: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            border: 1px solid var(--gray-light);
        }
        
        .image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .image-placeholder {
            text-align: center;
            color: var(--gray);
        }
        
        .image-placeholder i {
            font-size: 60px;
            margin-bottom: 15px;
            color: var(--gray-light);
        }
        
        /* Model Results */
        .model-results {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .prediction-result {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-radius: 10px;
            padding: 25px;
            border-left: 5px solid var(--primary);
        }
        
        .prediction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .prediction-label {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .confidence {
            font-size: 16px;
            font-weight: 500;
            color: var(--primary);
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .confidence.high {
            color: var(--secondary);
            background: #d1fae5;
        }
        
        .confidence.medium {
            color: var(--warning);
            background: #fef3c7;
        }
        
        .confidence.low {
            color: var(--danger);
            background: #fee2e2;
        }
        
        .prediction-description {
            color: var(--gray);
            font-size: 15px;
            line-height: 1.5;
        }
        
        /* Probability Distribution */
        .probability-distribution {
            margin-top: 10px;
        }
        
        .probability-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .probability-label {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 40%;
        }
        
        .probability-bar {
            flex-grow: 1;
            height: 10px;
            background: var(--gray-light);
            border-radius: 5px;
            overflow: hidden;
            margin: 0 15px;
        }
        
        .probability-fill {
            height: 100%;
            border-radius: 5px;
            background: var(--primary);
            transition: width 1s ease;
        }
        
        .probability-value {
            width: 60px;
            text-align: right;
            font-weight: 500;
        }
        
        /* XAI Explanations */
        .xai-techniques {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .xai-techniques {
                grid-template-columns: 1fr;
            }
        }
        
        .xai-card {
            border: 1px solid var(--gray-light);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .xai-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }
        
        .xai-card.active {
            border-color: var(--primary);
            background-color: #f0f9ff;
        }
        
        .xai-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .xai-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .xai-title {
            font-weight: 600;
            color: var(--dark);
        }
        
        .xai-description {
            font-size: 14px;
            color: var(--gray);
            line-height: 1.5;
        }
        
        /* Visualization Area */
        .visualization-area {
            height: 300px;
            background: #f8fafc;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            border: 1px solid var(--gray-light);
            overflow: hidden;
        }
        
        .visualization-placeholder {
            text-align: center;
            color: var(--gray);
        }
        
        .visualization-placeholder i {
            font-size: 60px;
            margin-bottom: 15px;
            color: var(--gray-light);
        }
        
        /* Feature Attribution */
        .feature-attribution {
            margin-top: 25px;
        }
        
        .feature-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .feature-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        
        .feature-name {
            font-weight: 500;
        }
        
        .feature-impact {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .impact-bar {
            width: 100px;
            height: 8px;
            background: var(--gray-light);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .impact-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .positive-impact {
            background: var(--secondary);
        }
        
        .negative-impact {
            background: var(--danger);
        }
        
        .impact-value {
            font-size: 14px;
            font-weight: 500;
            width: 40px;
            text-align: right;
        }
        
        /* Decision Factors */
        .decision-factors {
            margin-top: 25px;
        }
        
        .factor-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .factor-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .factor-icon {
            color: var(--primary);
            font-size: 18px;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 1px solid var(--gray-light);
        }
        
        .btn-secondary:hover {
            background: #f8fafc;
        }
        
        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 30px 0;
            margin-top: 50px;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .footer-links {
            display: flex;
            gap: 25px;
        }
        
        .footer-links a {
            color: #cbd5e1;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: white;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .sample-images {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-brain"></i>
                    <h1>Med<span>XAI</span></h1>
                </div>
                <div class="header-info">
                    <div class="ai-model">
                        <i class="fas fa-robot"></i>
                        <span>CNN with Grad-CAM & LIME</span>
                    </div>
                    <div class="ai-model">
                        <i class="fas fa-shield-alt"></i>
                        <span>HIPAA Compliant</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="main-layout">
            <!-- Left Panel: Image Input & Results -->
            <div class="left-panel">
                <!-- Image Upload Panel -->
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-upload"></i> Upload Medical Image</h2>
                    
                    <div class="upload-area" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>Drag & Drop or Click to Upload</h3>
                        <p>Supported formats: JPEG, PNG, DICOM • Max size: 10MB</p>
                        <input type="file" id="fileInput" accept="image/*" style="display: none;">
                    </div>
                    
                    <div class="sample-images">
                        <div class="sample-img" data-image="pneumonia">
                            <img src="https://images.unsplash.com/photo-1559757148-5c350d0d3c56?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="Pneumonia">
                            <div class="sample-label">Pneumonia</div>
                        </div>
                        <div class="sample-img" data-image="normal">
                            <img src="https://images.unsplash.com/photo-1551601651-2a8555f1a136?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="Normal">
                            <div class="sample-label">Normal Chest</div>
                        </div>
                        <div class="sample-img" data-image="covid">
                            <img src="https://images.unsplash.com/photo-1584036561566-baf8f5f1b144?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="COVID-19">
                            <div class="sample-label">COVID-19</div>
                        </div>
                    </div>
                </div>
                
                <!-- Image Display -->
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-image"></i> Image Preview</h2>
                    
                    <div class="image-display">
                        <div class="image-container" id="imageContainer">
                            <div class="image-placeholder">
                                <i class="fas fa-x-ray"></i>
                                <p>No image selected</p>
                            </div>
                        </div>
                        <div id="imageInfo"></div>
                    </div>
                </div>
                
                <!-- Model Prediction Results -->
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-diagnoses"></i> AI Diagnosis</h2>
                    
                    <div class="model-results">
                        <div class="prediction-result">
                            <div class="prediction-header">
                                <div class="prediction-label" id="predictionLabel">No prediction yet</div>
                                <div class="confidence" id="confidenceScore">0%</div>
                            </div>
                            <div class="prediction-description" id="predictionDescription">
                                Upload a medical image to get an AI-powered diagnosis with explainable insights.
                            </div>
                        </div>
                        
                        <div class="probability-distribution">
                            <h3 style="margin-bottom: 15px; font-size: 16px;">Probability Distribution</h3>
                            <div id="probabilityBars">
                                <!-- Probability bars will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel: XAI Explanations -->
            <div class="right-panel">
                <!-- XAI Techniques -->
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-search"></i> Explainability Techniques</h2>
                    
                    <div class="xai-techniques">
                        <div class="xai-card active" data-technique="gradcam">
                            <div class="xai-header">
                                <div class="xai-icon">
                                    <i class="fas fa-map"></i>
                                </div>
                                <div class="xai-title">Grad-CAM</div>
                            </div>
                            <div class="xai-description">
                                Highlights regions of the image that were most influential in the model's decision using gradient information.
                            </div>
                        </div>
                        
                        <div class="xai-card" data-technique="lime">
                            <div class="xai-header">
                                <div class="xai-icon">
                                    <i class="fas fa-th-large"></i>
                                </div>
                                <div class="xai-title">LIME</div>
                            </div>
                            <div class="xai-description">
                                Creates interpretable models to explain individual predictions by perturbing the input and observing changes.
                            </div>
                        </div>
                        
                        <div class="xai-card" data-technique="shap">
                            <div class="xai-header">
                                <div class="xai-icon">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <div class="xai-title">SHAP</div>
                            </div>
                            <div class="xai-description">
                                Uses game theory to allocate feature importance, showing how each pixel contributes to the prediction.
                            </div>
                        </div>
                        
                        <div class="xai-card" data-technique="attention">
                            <div class="xai-header">
                                <div class="xai-icon">
                                    <i class="fas fa-eye"></i>
                                </div>
                                <div class="xai-title">Attention Maps</div>
                            </div>
                            <div class="xai-description">
                                Visualizes where the model "looks" when making predictions, showing attention weights across the image.
                            </div>
                        </div>
                    </div>
                    
                    <div class="visualization-area" id="visualizationArea">
                        <div class="visualization-placeholder">
                            <i class="fas fa-project-diagram"></i>
                            <p>Select an XAI technique to visualize model explanations</p>
                        </div>
                    </div>
                </div>
                
                <!-- Feature Attribution -->
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-chart-line"></i> Feature Attribution</h2>
                    
                    <div class="feature-attribution">
                        <div class="feature-list" id="featureList">
                            <!-- Feature items will be generated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Decision Factors -->
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-balance-scale"></i> Decision Factors</h2>
                    
                    <div class="decision-factors">
                        <div class="factor-list" id="factorList">
                            <!-- Decision factors will be generated here -->
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="analyzeBtn">
                            <i class="fas fa-play"></i> Analyze Image
                        </button>
                        <button class="btn btn-secondary" id="resetBtn">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                        <button class="btn btn-secondary" id="reportBtn">
                            <i class="fas fa-file-pdf"></i> Generate Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div>
                    <h3>MedXAI - Explainable AI for Healthcare</h3>
                    <p>Transparent AI for high-stakes medical decision making</p>
                </div>
                <div class="footer-links">
                    <a href="#"><i class="fas fa-shield-alt"></i> Privacy</a>
                    <a href="#"><i class="fas fa-book"></i> Documentation</a>
                    <a href="#"><i class="fas fa-envelope"></i> Contact</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Medical conditions data
        const medicalConditions = {
            pneumonia: {
                name: "Pneumonia",
                description: "Bacterial or viral infection causing inflammation in the air sacs of the lungs. The AI detected consolidation and opacity patterns in the lower lung fields.",
                confidence: 0.92,
                features: [
                    { name: "Consolidation", impact: 0.85, positive: true },
                    { name: "Air Bronchograms", impact: 0.72, positive: true },
                    { name: "Opacity Patterns", impact: 0.68, positive: true },
                    { name: "Clear Lung Fields", impact: -0.45, positive: false },
                    { name: "Vascular Markings", impact: -0.32, positive: false }
                ],
                factors: [
                    "Presence of consolidation in right lower lobe",
                    "Air bronchograms visible",
                    "Increased opacity with blurred margins",
                    "Absence of normal vascular markings in affected area"
                ]
            },
            normal: {
                name: "Normal Chest X-Ray",
                description: "No significant abnormalities detected. Lung fields are clear, cardiac silhouette is normal, and diaphragm contours are smooth.",
                confidence: 0.88,
                features: [
                    { name: "Clear Lung Fields", impact: 0.82, positive: true },
                    { name: "Normal Vascularity", impact: 0.75, positive: true },
                    { name: "Sharp Costophrenic Angles", impact: 0.68, positive: true },
                    { name: "Consolidation", impact: -0.72, positive: false },
                    { name: "Pleural Effusion", impact: -0.65, positive: false }
                ],
                factors: [
                    "Clear lung fields without opacities",
                    "Normal cardiac silhouette size",
                    "Sharp costophrenic angles bilaterally",
                    "No evidence of consolidation or effusion"
                ]
            },
            covid: {
                name: "COVID-19 Pneumonia",
                description: "Viral pneumonia patterns consistent with COVID-19 infection. The AI detected bilateral ground-glass opacities with peripheral distribution.",
                confidence: 0.86,
                features: [
                    { name: "Ground-Glass Opacities", impact: 0.89, positive: true },
                    { name: "Peripheral Distribution", impact: 0.81, positive: true },
                    { name: "Bilateral Involvement", impact: 0.76, positive: true },
                    { name: "Pleural Effusion", impact: -0.58, positive: false },
                    { name: "Lymphadenopathy", impact: -0.42, positive: false }
                ],
                factors: [
                    "Bilateral ground-glass opacities",
                    "Peripheral and posterior distribution",
                    "Multifocal rounded opacities",
                    "Crazy-paving pattern in some areas"
                ]
            }
        };

        // DOM Elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const imageContainer = document.getElementById('imageContainer');
        const imageInfo = document.getElementById('imageInfo');
        const predictionLabel = document.getElementById('predictionLabel');
        const confidenceScore = document.getElementById('confidenceScore');
        const predictionDescription = document.getElementById('predictionDescription');
        const probabilityBars = document.getElementById('probabilityBars');
        const visualizationArea = document.getElementById('visualizationArea');
        const featureList = document.getElementById('featureList');
        const factorList = document.getElementById('factorList');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const resetBtn = document.getElementById('resetBtn');
        const reportBtn = document.getElementById('reportBtn');
        const sampleImages = document.querySelectorAll('.sample-img');
        const xaiCards = document.querySelectorAll('.xai-card');

        // Current state
        let currentImage = null;
        let currentPrediction = null;
        let currentTechnique = 'gradcam';

        // Initialize
        function init() {
            // Set up event listeners
            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileUpload);
            
            analyzeBtn.addEventListener('click', analyzeImage);
            resetBtn.addEventListener('click', resetApp);
            reportBtn.addEventListener('click', generateReport);
            
            // Sample images
            sampleImages.forEach(img => {
                img.addEventListener('click', () => {
                    const imageType = img.getAttribute('data-image');
                    loadSampleImage(imageType);
                });
            });
            
            // XAI technique cards
            xaiCards.forEach(card => {
                card.addEventListener('click', () => {
                    // Remove active class from all cards
                    xaiCards.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked card
                    card.classList.add('active');
                    
                    // Update current technique
                    currentTechnique = card.getAttribute('data-technique');
                    
                    // Update visualization if we have a prediction
                    if (currentPrediction) {
                        updateVisualization();
                    }
                });
            });
            
            // Initialize probability bars
            initProbabilityBars();
            
            // Initialize feature list
            initFeatureList();
            
            // Initialize decision factors
            initDecisionFactors();
        }

        // Handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                alert('Please upload an image file.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                displayImage(e.target.result, file.name);
                currentImage = e.target.result;
                // Reset prediction
                currentPrediction = null;
                resetResults();
            };
            reader.readAsDataURL(file);
        }

        // Load sample image
        function loadSampleImage(imageType) {
            const sample = medicalConditions[imageType];
            if (!sample) return;
            
            // Get the sample image URL from the clicked element
            const imgElement = document.querySelector(`[data-image="${imageType}"] img`);
            const imageUrl = imgElement.src;
            
            displayImage(imageUrl, `${sample.name} Sample`);
            currentImage = imageUrl;
            
            // Auto-analyze after loading sample
            setTimeout(() => {
                simulateAnalysis(imageType);
            }, 500);
        }

        // Display image
        function displayImage(imageSrc, fileName) {
            imageContainer.innerHTML = '';
            const img = document.createElement('img');
            img.src = imageSrc;
            img.alt = 'Uploaded medical image';
            imageContainer.appendChild(img);
            
            imageInfo.innerHTML = `
                <p><strong>File:</strong> ${fileName}</p>
                <p><strong>Type:</strong> Chest X-Ray (CXR)</p>
                <p><strong>Dimensions:</strong> 1024×1024 pixels</p>
            `;
        }

        // Initialize probability bars
        function initProbabilityBars() {
            const conditions = ['Pneumonia', 'Normal', 'COVID-19', 'Tuberculosis', 'Other'];
            
            probabilityBars.innerHTML = '';
            
            conditions.forEach(condition => {
                const item = document.createElement('div');
                item.className = 'probability-item';
                
                const label = document.createElement('div');
                label.className = 'probability-label';
                label.textContent = condition;
                
                const bar = document.createElement('div');
                bar.className = 'probability-bar';
                
                const fill = document.createElement('div');
                fill.className = 'probability-fill';
                fill.style.width = '0%';
                
                const value = document.createElement('div');
                value.className = 'probability-value';
                value.textContent = '0%';
                
                bar.appendChild(fill);
                item.appendChild(label);
                item.appendChild(bar);
                item.appendChild(value);
                
                probabilityBars.appendChild(item);
            });
        }

        // Initialize feature list
        function initFeatureList() {
            featureList.innerHTML = `
                <div class="feature-item">
                    <div class="feature-name">No data available</div>
                    <div class="feature-impact">
                        <div class="impact-bar"><div class="impact-fill" style="width: 0%"></div></div>
                        <div class="impact-value">0%</div>
                    </div>
                </div>
            `;
        }

        // Initialize decision factors
        function initDecisionFactors() {
            factorList.innerHTML = `
                <div class="factor-item">
                    <i class="fas fa-info-circle factor-icon"></i>
                    <div>Upload and analyze an image to see decision factors</div>
                </div>
            `;
        }

        // Analyze image
        function analyzeImage() {
            if (!currentImage) {
                alert('Please upload an image first.');
                return;
            }
            
            // For demo purposes, simulate analysis with random condition
            const conditions = Object.keys(medicalConditions);
            const randomCondition = conditions[Math.floor(Math.random() * conditions.length)];
            simulateAnalysis(randomCondition);
        }

        // Simulate analysis (for demo)
        function simulateAnalysis(conditionType) {
            // Show loading state
            predictionLabel.textContent = 'Analyzing...';
            confidenceScore.textContent = 'Processing';
            confidenceScore.className = 'confidence';
            predictionDescription.textContent = 'AI model is analyzing the image features...';
            
            // Show loading in visualization area
            visualizationArea.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="spinner" style="width: 50px; height: 50px; border: 5px solid #e2e8f0; border-top: 5px solid #2563eb; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                    <p>Generating explainable insights...</p>
                </div>
            `;
            
            // Add CSS for spinner animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            // Simulate processing delay
            setTimeout(() => {
                const condition = medicalConditions[conditionType];
                currentPrediction = conditionType;
                
                // Update prediction
                predictionLabel.textContent = condition.name;
                
                // Update confidence with appropriate class
                const confidence = Math.round(condition.confidence * 100);
                confidenceScore.textContent = `${confidence}%`;
                
                if (confidence >= 80) {
                    confidenceScore.className = 'confidence high';
                } else if (confidence >= 60) {
                    confidenceScore.className = 'confidence medium';
                } else {
                    confidenceScore.className = 'confidence low';
                }
                
                // Update description
                predictionDescription.textContent = condition.description;
                
                // Update probability bars
                updateProbabilityBars(conditionType);
                
                // Update feature attribution
                updateFeatureAttribution(condition);
                
                // Update decision factors
                updateDecisionFactors(condition);
                
                // Update visualization
                updateVisualization();
                
                // Show success message
                showNotification('Analysis complete! XAI insights generated.', 'success');
            }, 2000);
        }

        // Update probability bars
        function updateProbabilityBars(conditionType) {
            const conditions = {
                'Pneumonia': conditionType === 'pneumonia' ? 0.92 : conditionType === 'normal' ? 0.05 : conditionType === 'covid' ? 0.03 : 0.02,
                'Normal': conditionType === 'normal' ? 0.88 : conditionType === 'pneumonia' ? 0.07 : conditionType === 'covid' ? 0.04 : 0.03,
                'COVID-19': conditionType === 'covid' ? 0.86 : conditionType === 'pneumonia' ? 0.08 : conditionType === 'normal' ? 0.05 : 0.03,
                'Tuberculosis': conditionType === 'pneumonia' ? 0.02 : conditionType === 'normal' ? 0.01 : conditionType === 'covid' ? 0.02 : 0.95,
                'Other': conditionType === 'pneumonia' ? 0.01 : conditionType === 'normal' ? 0.01 : conditionType === 'covid' ? 0.01 : 0.97
            };
            
            const probabilityItems = document.querySelectorAll('.probability-item');
            
            probabilityItems.forEach((item, index) => {
                const conditionName = Object.keys(conditions)[index];
                const probability = conditions[conditionName];
                
                const fill = item.querySelector('.probability-fill');
                const value = item.querySelector('.probability-value');
                
                // Animate the fill width
                setTimeout(() => {
                    fill.style.width = `${probability * 100}%`;
                    value.textContent = `${Math.round(probability * 100)}%`;
                }, index * 200);
            });
        }

        // Update feature attribution
        function updateFeatureAttribution(condition) {
            featureList.innerHTML = '';
            
            condition.features.forEach(feature => {
                const item = document.createElement('div');
                item.className = 'feature-item';
                
                const impactPercent = Math.round(Math.abs(feature.impact) * 100);
                
                item.innerHTML = `
                    <div class="feature-name">${feature.name}</div>
                    <div class="feature-impact">
                        <div class="impact-bar">
                            <div class="impact-fill ${feature.positive ? 'positive-impact' : 'negative-impact'}" 
                                 style="width: ${impactPercent}%"></div>
                        </div>
                        <div class="impact-value">${feature.positive ? '+' : '-'}${impactPercent}%</div>
                    </div>
                `;
                
                featureList.appendChild(item);
            });
        }

        // Update decision factors
        function updateDecisionFactors(condition) {
            factorList.innerHTML = '';
            
            condition.factors.forEach(factor => {
                const item = document.createElement('div');
                item.className = 'factor-item';
                
                item.innerHTML = `
                    <i class="fas fa-check-circle factor-icon" style="color: ${feature.positive ? '#10b981' : '#ef4444'}"></i>
                    <div>${factor}</div>
                `;
                
                factorList.appendChild(item);
            });
        }

        // Update visualization based on selected technique
        function updateVisualization() {
            if (!currentPrediction) return;
            
            const techniqueVisualizations = {
                gradcam: {
                    title: "Gradient-weighted Class Activation Mapping",
                    description: "Heatmap showing regions that most influenced the model's prediction. Warmer colors indicate higher importance.",
                    color: "#2563eb"
                },
                lime: {
                    title: "Local Interpretable Model-agnostic Explanations",
                    description: "Superpixel segmentation showing which image segments contribute positively (green) or negatively (red) to the prediction.",
                    color: "#10b981"
                },
                shap: {
                    title: "SHapley Additive exPlanations",
                    description: "Feature importance values derived from game theory, showing contribution of each region to the prediction.",
                    color: "#8b5cf6"
                },
                attention: {
                    title: "Attention Map Visualization",
                    description: "Shows where the model 'pays attention' when processing the image, with brighter areas receiving more focus.",
                    color: "#f59e0b"
                }
            };
            
            const viz = techniqueVisualizations[currentTechnique];
            
            // Create a synthetic visualization
            visualizationArea.innerHTML = `
                <div style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px;">
                    <div style="position: relative; width: 250px; height: 200px; margin-bottom: 20px;">
                        <!-- Base image -->
                        <div style="width: 100%; height: 100%; background: linear-gradient(45deg, #1e293b, #475569); border-radius: 8px; position: absolute;"></div>
                        
                        <!-- Visualization overlay -->
                        <div style="width: 100%; height: 100%; position: absolute; border-radius: 8px; overflow: hidden;">
                            ${generateVisualizationOverlay(currentTechnique)}
                        </div>
                        
                        <!-- Annotation markers -->
                        <div style="position: absolute; top: 30%; left: 40%; width: 20px; height: 20px; border-radius: 50%; background: ${viz.color}; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3);"></div>
                        <div style="position: absolute; top: 60%; left: 60%; width: 20px; height: 20px; border-radius: 50%; background: ${viz.color}; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3);"></div>
                        <div style="position: absolute; top: 45%; left: 25%; width: 15px; height: 15px; border-radius: 50%; background: ${viz.color}; border: 2px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3);"></div>
                    </div>
                    
                    <div style="text-align: center; max-width: 500px;">
                        <h3 style="color: ${viz.color}; margin-bottom: 10px;">${viz.title}</h3>
                        <p style="color: #64748b; font-size: 14px;">${viz.description}</p>
                        
                        <div style="display: flex; justify-content: center; gap: 20px; margin-top: 20px; font-size: 12px;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 15px; height: 15px; background: ${viz.color}; border-radius: 3px;"></div>
                                <span>High Importance</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 15px; height: 15px; background: ${currentTechnique === 'lime' ? '#ef4444' : '#cbd5e1'}; border-radius: 3px;"></div>
                                <span>${currentTechnique === 'lime' ? 'Negative Impact' : 'Low Importance'}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Generate visualization overlay based on technique
        function generateVisualizationOverlay(technique) {
            switch(technique) {
                case 'gradcam':
                    return `
                        <div style="width: 100%; height: 100%; background: radial-gradient(circle at 40% 30%, rgba(37, 99, 235, 0.7) 0%, transparent 70%),
                                      radial-gradient(circle at 60% 60%, rgba(37, 99, 235, 0.5) 0%, transparent 60%),
                                      radial-gradient(circle at 25% 45%, rgba(37, 99, 235, 0.3) 0%, transparent 50%);"></div>
                    `;
                case 'lime':
                    return `
                        <div style="width: 100%; height: 100%; display: grid; grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(6, 1fr); gap: 2px; padding: 5px;">
                            ${Array.from({length: 48}).map((_, i) => {
                                const isPositive = Math.random() > 0.6;
                                const intensity = Math.random() * 0.7 + 0.3;
                                return `<div style="background: ${isPositive ? `rgba(16, 185, 129, ${intensity})` : `rgba(239, 68, 68, ${intensity})`}; border-radius: 2px;"></div>`;
                            }).join('')}
                        </div>
                    `;
                case 'shap':
                    return `
                        <div style="width: 100%; height: 100%; background: 
                                    linear-gradient(45deg, 
                                        rgba(139, 92, 246, 0.1) 0%, 
                                        rgba(139, 92, 246, 0.4) 30%, 
                                        rgba(139, 92, 246, 0.7) 50%, 
                                        rgba(139, 92, 246, 0.4) 70%, 
                                        rgba(139, 92, 246, 0.1) 100%
                                    );"></div>
                    `;
                case 'attention':
                    return `
                        <div style="width: 100%; height: 100%; background: 
                                    radial-gradient(circle at 40% 30%, rgba(245, 158, 11, 0.8) 0%, transparent 50%),
                                    radial-gradient(circle at 60% 60%, rgba(245, 158, 11, 0.6) 0%, transparent 50%),
                                    radial-gradient(circle at 25% 45%, rgba(245, 158, 11, 0.4) 0%, transparent 50%);"></div>
                    `;
                default:
                    return '';
            }
        }

        // Reset app
        function resetApp() {
            currentImage = null;
            currentPrediction = null;
            
            // Reset image display
            imageContainer.innerHTML = `
                <div class="image-placeholder">
                    <i class="fas fa-x-ray"></i>
                    <p>No image selected</p>
                </div>
            `;
            
            imageInfo.innerHTML = '';
            
            // Reset results
            resetResults();
            
            // Reset visualization
            visualizationArea.innerHTML = `
                <div class="visualization-placeholder">
                    <i class="fas fa-project-diagram"></i>
                    <p>Select an XAI technique to visualize model explanations</p>
                </div>
            `;
            
            showNotification('Application reset successfully.', 'info');
        }

        // Reset results
        function resetResults() {
            predictionLabel.textContent = 'No prediction yet';
            confidenceScore.textContent = '0%';
            confidenceScore.className = 'confidence';
            predictionDescription.textContent = 'Upload a medical image to get an AI-powered diagnosis with explainable insights.';
            
            // Reset probability bars
            document.querySelectorAll('.probability-fill').forEach(fill => {
                fill.style.width = '0%';
            });
            
            document.querySelectorAll('.probability-value').forEach(value => {
                value.textContent = '0%';
            });
            
            // Reset feature list
            initFeatureList();
            
            // Reset decision factors
            initDecisionFactors();
        }

        // Generate report
        function generateReport() {
            if (!currentPrediction) {
                alert('Please analyze an image first to generate a report.');
                return;
            }
            
            showNotification('Generating XAI report...', 'info');
            
            // Simulate report generation
            setTimeout(() => {
                showNotification('XAI report generated successfully!', 'success');
                
                // In a real application, this would download a PDF
                // For demo, show a modal with report content
                const reportContent = `
                    <div style="padding: 20px; max-width: 500px; background: white; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                        <h2 style="color: #2563eb; margin-bottom: 20px;">XAI Analysis Report</h2>
                        <div style="margin-bottom: 15px;">
                            <strong>Condition:</strong> ${medicalConditions[currentPrediction].name}
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Confidence:</strong> ${Math.round(medicalConditions[currentPrediction].confidence * 100)}%
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>XAI Technique:</strong> ${document.querySelector('.xai-card.active .xai-title').textContent}
                        </div>
                        <div style="margin-bottom: 20px;">
                            <strong>Key Findings:</strong>
                            <ul style="margin-top: 10px; padding-left: 20px;">
                                ${medicalConditions[currentPrediction].factors.map(factor => `<li>${factor}</li>`).join('')}
                            </ul>
                        </div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 20px; border-top: 1px solid #e2e8f0; padding-top: 15px;">
                            Report generated by MedXAI on ${new Date().toLocaleDateString()}. This report is for informational purposes only and should not replace professional medical advice.
                        </div>
                    </div>
                `;
                
                // Create a modal to show the report
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                `;
                
                modal.innerHTML = reportContent;
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
                
                document.body.appendChild(modal);
            }, 1500);
        }

        // Show notification
        function showNotification(message, type) {
            // Remove existing notification
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                document.body.removeChild(existingNotification);
            }
            
            // Create notification
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            const bgColor = type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#2563eb';
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 1001;
                animation: slideIn 0.3s ease;
                display: flex;
                align-items: center;
                gap: 10px;
                max-width: 400px;
            `;
            
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 4 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }
            }, 4000);
            
            // Add animation styles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
